name: Build Arch Linux KDE Live CD

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  workflow_dispatch:

jobs:
  build-livecd:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Arch Linux container
        run: |
          # Descargar imagen de Arch Linux
          docker pull archlinux:latest

          # Crear contenedor con privilegios necesarios
          docker run -d --name arch-builder --privileged \
            -v $PWD:/host-workspace \
            archlinux:latest sleep infinity

          # Actualizar sistema y instalar dependencias
          docker exec arch-builder pacman -Syu --noconfirm
          docker exec arch-builder pacman -S --noconfirm archiso git base-devel wget

      - name: Create archiso profile
        run: |
          docker exec arch-builder bash -c '
          # Crear directorio de trabajo
          mkdir -p /build/archiso-kde
          cd /build/archiso-kde

          # Copiar perfil base de archiso
          cp -r /usr/share/archiso/configs/releng/* .

          # Crear lista de paquetes personalizada
          cat > packages.x86_64 << "PKGEOF"
          # Base system
          base
          base-devel
          linux
          linux-firmware
          mkinitcpio
          mkinitcpio-archiso
          mkinitcpio-nfs-utils
          archiso
          nbd

          # Boot
          syslinux
          efibootmgr
          grub
          os-prober

          # Filesystem tools
          dosfstools
          e2fsprogs
          ntfs-3g
          exfatprogs
          btrfs-progs
          xfsprogs
          f2fs-tools
          jfsutils

          # Network
          networkmanager
          network-manager-applet
          dhcpcd
          wpa_supplicant
          wireless_tools
          iwd
          inetutils
          dnsutils
          nftables
          iptables-nft
          reflector

          # Hardware support
          mesa
          xf86-video-amdgpu
          xf86-video-ati
          xf86-input-libinput
          vulkan-radeon

          # Audio
          pipewire
          pipewire-alsa
          pipewire-pulse
          pipewire-jack
          wireplumber
          pavucontrol

          # KDE Plasma (completo pero optimizado)
          plasma-desktop
          plasma-nm
          plasma-pa
          powerdevil
          sddm
          sddm-kcm
          breeze
          breeze-gtk
          kde-gtk-config
          kscreen
          kinfocenter
          systemsettings

          # Aplicaciones KDE esenciales
          konsole
          dolphin
          ark
          okular
          gwenview

          # Navegador y multimedia
          firefox

          # System tools
          htop
          fastfetch
          git
          vim
          nano
          wget
          curl
          rsync
          tree
          lsof
          which
          sudo

          # Fonts
          ttf-dejavu
          ttf-liberation
          noto-fonts
          noto-fonts-emoji
          terminus-font

          # Archive tools
          zip
          unzip
          p7zip
          unrar

          # Live system and installation tools
          arch-install-scripts
          archinstall
          gparted
          parted
          dialog

          # Development tools (optional)
          python
          python-pip

          # Additional utilities
          man-db
          man-pages
          PKGEOF
          '

      - name: Create archinstall configuration
        run: |
          docker exec arch-builder bash -c '
          cd /build/archiso-kde
          mkdir -p airootfs/usr/local/bin
          mkdir -p airootfs/etc/archinstall

          # Crear user_configuration.json (tu configuraciÃ³n corregida)
          cat > airootfs/etc/archinstall/user_configuration.json << "CONFIGEOF"
          {
            "archinstall-language": "English",
            "audio_config": {
              "audio": "pipewire"
            },
            "bootloader": "Grub",
            "custom_commands": [],
            "disk_config": {
              "btrfs_options": {
                "snapshot_config": null
              },
              "config_type": "default_layout",
              "device_modifications": [
                {
                  "device": "/dev/nvme0n1",
                  "partitions": [
                    {
                      "btrfs": [],
                      "dev_path": null,
                      "flags": ["boot", "esp"],
                      "fs_type": "fat32",
                      "mount_options": [],
                      "mountpoint": "/boot",
                      "obj_id": "592c23ff-1230-495d-aea9-c6af6ef3de13",
                      "size": {
                        "sector_size": {
                          "unit": "B",
                          "value": 512
                        },
                        "unit": "GiB",
                        "value": 1
                      },
                      "start": {
                        "sector_size": {
                          "unit": "B",
                          "value": 512
                        },
                        "unit": "MiB",
                        "value": 1
                      },
                      "status": "create",
                      "type": "primary"
                    },
                    {
                      "btrfs": [],
                      "dev_path": null,
                      "flags": [],
                      "fs_type": "ext4",
                      "mount_options": [],
                      "mountpoint": "/",
                      "obj_id": "659fd4df-7b61-4df2-923c-f6aba8ba66a1",
                      "size": {
                        "sector_size": {
                          "unit": "B",
                          "value": 512
                        },
                        "unit": "%",
                        "value": "100%FREE"
                      },
                      "start": {
                        "sector_size": {
                          "unit": "B",
                          "value": 512
                        },
                        "unit": "B",
                        "value": 1074790400
                      },
                      "status": "create",
                      "type": "primary"
                    }
                  ],
                  "wipe": true
                }
              ]
            },
            "hostname": "archlinux",
            "kernels": ["linux"],
            "locale_config": {
              "kb_layout": "es",
              "sys_enc": "UTF-8",
              "sys_lang": "en_US.UTF-8"
            },
            "mirror_config": {
              "custom_repositories": [],
              "custom_servers": [],
              "mirror_regions": {
                "Spain": [
                  "https://ftp.rediris.es/mirror/archlinux/$repo/os/$arch",
                  "http://es.mirrors.cicku.me/archlinux/$repo/os/$arch",
                  "https://es.mirrors.cicku.me/archlinux/$repo/os/$arch",
                  "https://nox.panibrez.com/archlinux/$repo/os/$arch",
                  "http://mirror.raiolanetworks.com/archlinux/$repo/os/$arch",
                  "https://mirror.raiolanetworks.com/archlinux/$repo/os/$arch"
                ],
                "United States": [
                  "http://mirrors.rit.edu/archlinux/$repo/os/$arch",
                  "https://mirrors.rit.edu/archlinux/$repo/os/$arch",
                  "http://mirror.umd.edu/archlinux/$repo/os/$arch",
                  "https://mirror.umd.edu/archlinux/$repo/os/$arch",
                  "http://ftp.osuosl.org/pub/archlinux/$repo/os/$arch",
                  "https://ftp.osuosl.org/pub/archlinux/$repo/os/$arch",
                  "http://mirrors.lug.mtu.edu/archlinux/$repo/os/$arch",
                  "https://mirrors.lug.mtu.edu/archlinux/$repo/os/$arch",
                  "http://mirrors.xmission.com/archlinux/$repo/os/$arch",
                  "http://mirrors.kernel.org/archlinux/$repo/os/$arch",
                  "https://mirrors.kernel.org/archlinux/$repo/os/$arch",
                  "http://mirrors.cat.pdx.edu/archlinux/$repo/os/$arch",
                  "http://mirror.sfo12.us.leaseweb.net/archlinux/$repo/os/$arch",
                  "http://mirror.wdc1.us.leaseweb.net/archlinux/$repo/os/$arch",
                  "https://mirror.sfo12.us.leaseweb.net/archlinux/$repo/os/$arch",
                  "https://mirror.wdc1.us.leaseweb.net/archlinux/$repo/os/$arch",
                  "http://mirrors.gigenet.com/archlinux/$repo/os/$arch",
                  "http://mirrors.liquidweb.com/archlinux/$repo/os/$arch",
                  "http://mirror.metrocast.net/archlinux/$repo/os/$arch",
                  "http://dfw.mirror.rackspace.com/archlinux/$repo/os/$arch",
                  "http://iad.mirror.rackspace.com/archlinux/$repo/os/$arch",
                  "http://ord.mirror.rackspace.com/archlinux/$repo/os/$arch",
                  "https://dfw.mirror.rackspace.com/archlinux/$repo/os/$arch",
                  "https://iad.mirror.rackspace.com/archlinux/$repo/os/$arch",
                  "https://ord.mirror.rackspace.com/archlinux/$repo/os/$arch",
                  "http://mirror.vtti.vt.edu/archlinux/$repo/os/$arch",
                  "http://arch.mirror.constant.com/$repo/os/$arch",
                  "https://arch.mirror.constant.com/$repo/os/$arch",
                  "http://mirrors.acm.wpi.edu/archlinux/$repo/os/$arch",
                  "http://mirrors.ocf.berkeley.edu/archlinux/$repo/os/$arch",
                  "https://mirrors.ocf.berkeley.edu/archlinux/$repo/os/$arch",
                  "http://arlm.tyzoid.com/$repo/os/$arch",
                  "http://mirror.math.princeton.edu/pub/archlinux/$repo/os/$arch",
                  "http://us.mirrors.cicku.me/archlinux/$repo/os/$arch",
                  "https://us.mirrors.cicku.me/archlinux/$repo/os/$arch",
                  "http://mirror.cs.vt.edu/pub/ArchLinux/$repo/os/$arch",
                  "http://mirrors.sonic.net/archlinux/$repo/os/$arch",
                  "https://mirrors.sonic.net/archlinux/$repo/os/$arch",
                  "http://distro.ibiblio.org/archlinux/$repo/os/$arch",
                  "http://repo.miserver.it.umich.edu/archlinux/$repo/os/$arch",
                  "http://mirrors.xtom.com/archlinux/$repo/os/$arch",
                  "https://mirrors.xtom.com/archlinux/$repo/os/$arch",
                  "http://mirror.siena.edu/archlinux/$repo/os/$arch",
                  "http://repo.ialab.dsu.edu/archlinux/$repo/os/$arch",
                  "https://repo.ialab.dsu.edu/archlinux/$repo/os/$arch",
                  "http://iad.mirrors.misaka.one/archlinux/$repo/os/$arch",
                  "https://iad.mirrors.misaka.one/archlinux/$repo/os/$arch",
                  "http://mirror.pit.teraswitch.com/archlinux/$repo/os/$arch",
                  "https://mirror.pit.teraswitch.com/archlinux/$repo/os/$arch",
                  "http://mirror.arizona.edu/archlinux/$repo/os/$arch",
                  "https://mirror.arizona.edu/archlinux/$repo/os/$arch",
                  "http://archmirror1.octyl.net/$repo/os/$arch",
                  "https://archmirror1.octyl.net/$repo/os/$arch",
                  "http://plug-mirror.rcac.purdue.edu/archlinux/$repo/os/$arch",
                  "https://plug-mirror.rcac.purdue.edu/archlinux/$repo/os/$arch",
                  "http://mirrors.mit.edu/archlinux/$repo/os/$arch",
                  "https://mirrors.mit.edu/archlinux/$repo/os/$arch",
                  "http://arch.hu.fo/archlinux/$repo/os/$arch",
                  "https://arch.hu.fo/archlinux/$repo/os/$arch",
                  "https://zxcvfdsa.com/arch/$repo/os/$arch",
                  "http://mirror.ette.biz/archlinux/$repo/os/$arch",
                  "https://mirror.ette.biz/archlinux/$repo/os/$arch",
                  "https://mirror.theash.xyz/arch/$repo/os/$arch",
                  "http://mirrors.bloomu.edu/archlinux/$repo/os/$arch",
                  "https://mirrors.bloomu.edu/archlinux/$repo/os/$arch",
                  "http://codingflyboy.mm.fcix.net/archlinux/$repo/os/$arch",
                  "http://coresite.mm.fcix.net/archlinux/$repo/os/$arch",
                  "http://forksystems.mm.fcix.net/archlinux/$repo/os/$arch",
                  "http://irltoolkit.mm.fcix.net/archlinux/$repo/os/$arch",
                  "http://mirror.fcix.net/archlinux/$repo/os/$arch",
                  "http://mnvoip.mm.fcix.net/archlinux/$repo/os/$arch",
                  "http://nnenix.mm.fcix.net/archlinux/$repo/os/$arch",
                  "http://nocix.mm.fcix.net/archlinux/$repo/os/$arch",
                  "http://ohioix.mm.fcix.net/archlinux/$repo/os/$arch",
                  "http://opencolo.mm.fcix.net/archlinux/$repo/os/$arch",
                  "http://ridgewireless.mm.fcix.net/archlinux/$repo/os/$arch",
                  "http://southfront.mm.fcix.net/archlinux/$repo/os/$arch",
                  "http://volico.mm.fcix.net/archlinux/$repo/os/$arch",
                  "http://ziply.mm.fcix.net/archlinux/$repo/os/$arch",
                  "https://codingflyboy.mm.fcix.net/archlinux/$repo/os/$arch",
                  "https://coresite.mm.fcix.net/archlinux/$repo/os/$arch",
                  "https://forksystems.mm.fcix.net/archlinux/$repo/os/$arch",
                  "https://irltoolkit.mm.fcix.net/archlinux/$repo/os/$arch",
                  "https://mirror.fcix.net/archlinux/$repo/os/$arch",
                  "https://mnvoip.mm.fcix.net/archlinux/$repo/os/$arch",
                  "https://nnenix.mm.fcix.net/archlinux/$repo/os/$arch",
                  "https://nocix.mm.fcix.net/archlinux/$repo/os/$arch",
                  "https://ohioix.mm.fcix.net/archlinux/$repo/os/$arch",
                  "https://opencolo.mm.fcix.net/archlinux/$repo/os/$arch",
                  "https://ridgewireless.mm.fcix.net/archlinux/$repo/os/$arch",
                  "https://southfront.mm.fcix.net/archlinux/$repo/os/$arch",
                  "https://volico.mm.fcix.net/archlinux/$repo/os/$arch",
                  "https://ziply.mm.fcix.net/archlinux/$repo/os/$arch",
                  "https://america.mirror.pkgbuild.com/$repo/os/$arch",
                  "https://losangeles.mirror.pkgbuild.com/$repo/os/$arch",
                  "http://mirrors.vectair.net/archlinux/$repo/os/$arch",
                  "https://mirrors.vectair.net/archlinux/$repo/os/$arch",
                  "https://arch.mirror.k0.ae/$repo/os/$arch",
                  "https://mirror.zackmyers.io/archlinux/$repo/os/$arch",
                  "http://mirror.fossable.org/archlinux/$repo/os/$arch",
                  "https://m.lqy.me/arch/$repo/os/$arch",
                  "http://mirror.adectra.com/archlinux/$repo/os/$arch",
                  "https://mirror.adectra.com/archlinux/$repo/os/$arch",
                  "https://arch.goober.cloud/$repo/os/$arch",
                  "http://mirrors.bjg.at/arch/$repo/os/$arch",
                  "https://mirrors.bjg.at/arch/$repo/os/$arch",
                  "https://mirror.pilotfiber.com/archlinux/$repo/os/$arch",
                  "http://mirrors.iu13.net/archlinux/$repo/os/$arch",
                  "https://mirrors.iu13.net/archlinux/$repo/os/$arch",
                  "http://mirror.colonelhosting.com/archlinux/$repo/os/$arch",
                  "https://mirror.colonelhosting.com/archlinux/$repo/os/$arch",
                  "http://us.arch.niranjan.co/$repo/os/$arch",
                  "https://us.arch.niranjan.co/$repo/os/$arch",
                  "http://mirror.hasphetica.win/archlinux/$repo/os/$arch",
                  "https://mirror.hasphetica.win/archlinux/$repo/os/$arch",
                  "https://arch.mirror.marcusspencer.us:4443/archlinux/$repo/os/$arch",
                  "https://us-mnz.soulharsh007.dev/archlinux/$repo/os/$arch",
                  "http://arch.miningtcup.me/$repo/os/$arch",
                  "https://arch.miningtcup.me/$repo/os/$arch",
                  "http://mirrors.smeal.xyz/arch-linux/$repo/os/$arch",
                  "https://mirrors.smeal.xyz/arch-linux/$repo/os/$arch",
                  "https://arch-mirror.brightlight.today/$repo/os/$arch",
                  "https://yonderly.org/mirrors/archlinux/$repo/os/$arch",
                  "https://mirrors.lahansons.com/archlinux/$repo/os/$arch",
                  "https://mirror.givebytes.net/archlinux/$repo/os/$arch",
                  "https://mirrors.shr.cx/arch/$repo/os/$arch"
                ]
              },
              "optional_repositories": []
            },
            "network_config": {
              "type": "nm"
            },
            "ntp": true,
            "packages": ["base-devel", "curl", "firefox", "git", "nano", "plymouth", "gwenview"],
            "parallel_downloads": 0,
            "profile_config": {
              "gfx_driver": "AMD / ATI (open-source)",
              "greeter": "sddm",
              "profile": {
                "custom_settings": {
                  "KDE Plasma": {}
                },
                "details": ["KDE Plasma"],
                "main": "Desktop"
              }
            },
            "services": [],
            "swap": true,
            "timezone": "UTC",
            "version": null
          }

          CONFIGEOF

          # Crear user_credentials.json
          cat > airootfs/etc/archinstall/user_credentials.json << "CREDSEOF"
          {
            "root_enc_password": null,
            "users": [
              {
                "enc_password": "$y$j9T$KhIE2mo2XuF5jlv8me5rB.$JN3y4/uH9fq32Cm/sIMgvD8REfgNUhWBNpwIJofd6X8",
                "groups": [],
                "sudo": true,
                "username": "playnix"
              }
            ]
          }

          CREDSEOF

          # Crear script wrapper para detecciÃ³n automÃ¡tica de disco
          cat > airootfs/usr/local/bin/arch-installer << "INSTALLEREOF"
          #!/bin/bash

          # PlayNix Arch Linux Installer - Usando archinstall oficial
          sudo archinstall --config /etc/archinstall/user_configuration.json --creds /etc/archinstall/user_credentials.json --silent

          INSTALLEREOF

          chmod +x airootfs/usr/local/bin/arch-installer
          '

      - name: Configure desktop entries
        run: |
          docker exec arch-builder bash -c '
          cd /build/archiso-kde
          mkdir -p airootfs/etc/skel/Desktop
          mkdir -p airootfs/root/Desktop

          cat > airootfs/etc/skel/Desktop/arch-installer.desktop << "DESKTOP_EOF"
          [Desktop Entry]
          Name=Instalador de Arch Linux
          Comment=Instala Arch Linux en tu computadora
          Exec=konsole --hold -e sudo arch-installer
          Icon=system-software-install
          Terminal=false
          Type=Application
          Categories=System;
          DESKTOP_EOF

          cat > airootfs/etc/skel/Desktop/gparted.desktop << "GPARTED_EOF"
          [Desktop Entry]
          Name=GParted
          Comment=Editor de particiones
          Exec=sudo gparted
          Icon=gparted
          Terminal=false
          Type=Application
          Categories=System;
          GPARTED_EOF

          chmod +x airootfs/etc/skel/Desktop/*.desktop
          cp airootfs/etc/skel/Desktop/*.desktop airootfs/root/Desktop/
          chmod +x airootfs/root/Desktop/*.desktop
          '

      - name: Create pacman.conf
        run: |
          docker exec arch-builder bash -c '
          cd /build/archiso-kde

          cat > pacman.conf << "PACMANEOF"
          [options]
          HoldPkg = pacman glibc
          Architecture = x86_64
          Color
          CheckSpace
          ParallelDownloads = 10
          SigLevel = Required DatabaseOptional
          LocalFileSigLevel = Optional

          [core]
          Include = /etc/pacman.d/mirrorlist

          [extra]
          Include = /etc/pacman.d/mirrorlist

          [multilib]
          Include = /etc/pacman.d/mirrorlist
          PACMANEOF
          '

      - name: Configure system customization
        run: |
          docker exec arch-builder bash -c '
          cd /build/archiso-kde
          mkdir -p airootfs/etc/skel/.config
          mkdir -p airootfs/etc/systemd/system
          mkdir -p airootfs/etc/sddm.conf.d

          cat > airootfs/root/customize_airootfs.sh << "CUSTOMEOF"
          #!/usr/bin/env bash
          set -e -u

          echo "Iniciando customizaciÃ³n..."

          # Locale
          sed -i "s/#en_US.UTF-8/en_US.UTF-8/" /etc/locale.gen
          sed -i "s/#es_ES.UTF-8/es_ES.UTF-8/" /etc/locale.gen
          locale-gen
          echo "LANG=en_US.UTF-8" > /etc/locale.conf
          echo "KEYMAP=es" > /etc/vconsole.conf

          # Timezone
          ln -sf /usr/share/zoneinfo/UTC /etc/localtime

          # Usuario
          useradd -m -G wheel,audio,video,storage,network -s /bin/bash liveuser
          passwd -d liveuser
          passwd -d root
          echo "%wheel ALL=(ALL:ALL) NOPASSWD: ALL" >> /etc/sudoers

          # Servicios
          systemctl enable NetworkManager.service
          systemctl enable sddm.service

          # SDDM autologin
          cat > /etc/sddm.conf.d/autologin.conf << EOF
          [Autologin]
          User=liveuser
          Session=plasma
          [Theme]
          Current=breeze
          EOF

          # Hostname
          echo "archiso-kde" > /etc/hostname

          # Bashrc
          cat >> /home/liveuser/.bashrc << EOF
          alias ll="ls -la"
          echo "=== Arch Linux KDE Live ==="
          echo "Usuario: liveuser (sin contraseÃ±a)"
          EOF

          chown -R liveuser:liveuser /home/liveuser
          pacman -Scc --noconfirm
          CUSTOMEOF

          chmod +x airootfs/root/customize_airootfs.sh
          '

      - name: Configure boot
        run: |
          docker exec arch-builder bash -c '
          cd /build/archiso-kde

          # GRUB
          mkdir -p grub
          cat > grub/grub.cfg << "GRUBEOF"
          set default="0"
          set timeout=5

          menuentry "Arch Linux KDE Live" {
              linux /%INSTALL_DIR%/boot/x86_64/vmlinuz-linux archisobasedir=%INSTALL_DIR% archisolabel=%ARCHISO_LABEL% quiet
              initrd /%INSTALL_DIR%/boot/x86_64/initramfs-linux.img
          }
          GRUBEOF

          # Syslinux
          cat > syslinux/archiso_sys-linux.cfg << "SYSEOF"
          LABEL arch64
          MENU LABEL Arch Linux KDE Live
          LINUX /%INSTALL_DIR%/boot/x86_64/vmlinuz-linux
          INITRD /%INSTALL_DIR%/boot/x86_64/initramfs-linux.img
          APPEND archisobasedir=%INSTALL_DIR% archisolabel=%ARCHISO_LABEL% quiet
          SYSEOF

          # SystemD-boot
          mkdir -p efiboot/loader/entries
          cat > efiboot/loader/loader.conf << "LOADEREOF"
          default archiso-x86_64-linux.conf
          timeout 3
          LOADEREOF

          cat > efiboot/loader/entries/archiso-x86_64-linux.conf << "ENTRYEOF"
          title Arch Linux KDE Live
          linux /%INSTALL_DIR%/boot/x86_64/vmlinuz-linux
          initrd /%INSTALL_DIR%/boot/x86_64/initramfs-linux.img
          options archisobasedir=%INSTALL_DIR% archisolabel=%ARCHISO_LABEL% quiet
          ENTRYEOF

          # Profile
          cat > profiledef.sh << "PROFILEEOF"
          #!/usr/bin/env bash
          iso_name="archlinux-kde"
          iso_label="ARCH_KDE_$(date +%Y%m)"
          iso_publisher="Arch Linux KDE Live"
          iso_application="Arch Linux KDE Live CD"
          iso_version="$(date +%Y.%m.%d)"
          install_dir="arch"
          buildmodes=("iso")
          bootmodes=("bios.syslinux.mbr" "bios.syslinux.eltorito" "uefi-x64.systemd-boot.esp" "uefi-x64.systemd-boot.eltorito")
          arch="x86_64"
          pacman_conf="pacman.conf"
          airootfs_image_type="squashfs"
          airootfs_image_tool_options=("-comp" "xz" "-b" "1M")
          file_permissions=(
            ["/root"]="0:0:750"
            ["/root/customize_airootfs.sh"]="0:0:755"
            ["/usr/local/bin/arch-installer"]="0:0:755"
          )
          PROFILEEOF
          '

      - name: Build ISO
        run: |
          docker exec arch-builder bash -c '
          cd /build/archiso-kde
          echo "=== Archivos del proyecto ==="
          ls -la
          echo "=== Construyendo ISO ==="
          mkarchiso -v -w work -o out .
          ls -la out/
          '
          mkdir -p iso-output
          docker cp arch-builder:/build/archiso-kde/out/. ./iso-output/
          ls -lh ./iso-output/

      - name: Cleanup
        if: always()
        run: |
          docker stop arch-builder || true
          docker rm arch-builder || true

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: arch-kde-livecd
          path: iso-output/*.iso
          retention-days: 30

      - name: Create Release
        if: github.ref == 'refs/heads/main' && github.event_name == 'push'
        uses: softprops/action-gh-release@v1
        with:
          tag_name: v${{ github.run_number }}
          name: Arch Linux KDE Live CD v${{ github.run_number }}
          body: |
            # ð§ Arch Linux KDE Live CD
          files: iso-output/*.iso
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
